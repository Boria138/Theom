#!/bin/bash

# This script sets up the de details that we might need to access later.
# Never edit files generated by `THEOM SCARY CONFIG DEMON`

TSCL_PATH="$HOME/.local/state/theom/meta.tscd"
TSC="/usr/share/theom/scripts/tscdctl"

[ ! -d "$HOME/.local/state/theom" ] && mkdir -p "$HOME/.local/state/theom"

theom_version=$(< /usr/share/theom/version)
theom_version="${theom_version//$'\n'/}"

# Does version check
/usr/share/theom/scripts/check_version

if [ ! -f "$TSCL_PATH" ]; then
    $TSC --out "$TSCL_PATH" \
        --set version="$theom_version" first_run=false current_run=true
else
    PREV_VAL=$($TSC --out "$TSCL_PATH" --get first_run 2>/dev/null)

    if [ "$PREV_VAL" = "true" ]; then
        $TSC --out "$TSCL_PATH" \
            --set version="$theom_version" current_run=true \
            --flip first_run
    else
        $TSC --out "$TSCL_PATH" \
            --set version="$theom_version" current_run=false
    fi
fi
